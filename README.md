# Gophermart

Gophermart — это HTTP API сервис лояльности, написанный на Go.  
Он позволяет пользователям регистрироваться, загружать номера заказов, накапливать бонусы и списывать их.  
Проект реализует работу с PostgreSQL, авторизацию, gzip-сжатие, middleware и юнит-тесты.

## Цель проекта

Разработать backend-сервис программы лояльности, который:
- принимает и обрабатывает HTTP-запросы;
- хранит и управляет пользовательскими данными в PostgreSQL;
- начисляет и списывает бонусы за заказы;
- реализует аутентификацию и авторизацию пользователей;
- обеспечивает стабильную работу и проходит автоматические тесты.

## Выполненные задачи

- Реализованы регистрация и авторизация пользователей.  
- Добавлена загрузка номеров заказов с проверкой по алгоритму Луна.  
- Внедрено начисление и списание бонусов.  
- Настроено хранение данных в PostgreSQL.  
- Добавлена авторизация через куки.  
- Реализовано gzip-сжатие ответов.  
- Написаны юнит-тесты и моки для хендлеров и бизнес-логики.  
- Настроены валидация, логгирование и обработка ошибок.  
- Проект реализован по принципам слоистой архитектуры (handlers → service → storage).

## Результаты

- Создан REST API сервис программы лояльности.  
- Настроено хранение данных в PostgreSQL с использованием sqlc.  
- Реализованы авторизация, gzip и логгирование.  
- Покрытие кода тестами превышает 80%.  
- Проект прошёл все автотесты курса Яндекс.Практикум и соответствует принципам чистой архитектуры.


## Архитектура проекта

```
internal/
├── app           # Инициализация роутера и зависимостей
├── handlers      # HTTP-обработчики
├── service       # Бизнес-логика
├── storage       # Работа с базой данных (PostgreSQL + sqlc)
├── validation    # Валидация входных данных
├── middleware    # Авторизация, логгирование, gzip
├── db            # SQL-скрипты и sqlc-генерация
└── mocks         # Сгенерированные моки для тестирования
```

## Используемые технологии

- Go 1.23+  
- PostgreSQL  
- sqlc (генерация кода по SQL)  
- chi/v5 (роутер и middleware)  
- zap (структурированное логгирование)  
- testify + gomock (тестирование и моки)  
- Docker Compose (локальное окружение)

## Как запустить

### 1. Клонировать репозиторий
```bash
git clone https://github.com/NailUsmanov/gophermart.git
cd gophermart
```

### 2. Создать файл `.env`
```env
DATABASE_DSN=postgres://user:password@localhost:5432/gophermart?sslmode=disable
RUN_ADDRESS=:8080
```

### 3. Поднять PostgreSQL (через Docker)
```bash
docker-compose up -d
```

### 4. Применить миграции
(можно через sqlc или встроенные запросы)

### 5. Запустить приложение
```bash
go run ./cmd/server
```

### 6. Запустить тесты
```bash
go test ./... -v
```

## Основные API эндпоинты

| Метод | Путь | Описание |
|--------|------|-----------|
| POST | `/api/user/register` | Регистрация пользователя |
| POST | `/api/user/login` | Авторизация пользователя |
| POST | `/api/user/orders` | Загрузка номера заказа |
| GET  | `/api/user/orders` | Получение списка заказов |
| GET  | `/api/user/balance` | Проверка текущего баланса |
| POST | `/api/user/balance/withdraw` | Списание бонусов |
| GET  | `/api/user/withdrawals` | История списаний |

## Репозиторий

https://github.com/NailUsmanov/gophermart

## Автор

Наиль Усманов  
Backend-разработчик на Go
