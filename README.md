# Gophermart

Gophermart — это HTTP API сервис лояльности, написанный на Go.  
Он позволяет пользователям регистрироваться, загружать номера заказов, накапливать бонусы и списывать их.  
Проект реализует работу с PostgreSQL, авторизацию, gzip-сжатие, валидацию, мидлвары и тестирование.

## Цель проекта

Разработать надежный backend-сервис для программы лояльности, который:
- принимает и обрабатывает HTTP-запросы;
- хранит и управляет пользовательскими данными в PostgreSQL;
- обрабатывает заказы и начисляет бонусы по алгоритму;
- поддерживает регистрацию, логин и списание баллов;
- проходит автотесты и реализован по принципам чистой архитектуры.

## Возможности

- Регистрация и аутентификация пользователей  
- Загрузка номеров заказов (с проверкой алгоритмом Луна)  
- Начисление и списание бонусов  
- Хранение данных в PostgreSQL  
- Авторизация через куки  
- Сжатие ответов через gzip  
- Покрытие логики тестами  
- Валидация и логгирование  
- Многоуровневая архитектура (handlers → service → storage)

## Архитектура проекта

internal/
├── app           # Инициализация сервера и зависимостей
├── handlers      # HTTP-обработчики (эндпоинты)
├── service       # Бизнес-логика
├── storage       # Работа с PostgreSQL (через sqlc)
├── validation    # Проверка входных данных
├── middleware    # Авторизация, gzip, логгирование
├── db            # SQL-скрипты и генерация sqlc
└── mocks         # Моки для тестов

## Используемые технологии

- Go 1.23+
- PostgreSQL
- sqlc (генерация кода по SQL)
- chi/v5 (роутер и middleware)
- zap (логгирование)
- testify, gomock (тестирование)
- Docker Compose (для локального окружения)

## Основные API эндпоинты
POST /api/user/register
Регистрация пользователя

POST /api/user/login
Авторизация пользователя

POST /api/user/orders
Загрузка номера заказа

GET /api/user/orders
Получение списка заказов

GET /api/user/balance
Проверка текущего баланса

POST /api/user/balance/withdraw
Списание бонусов

GET /api/user/withdrawals
История списаний

## Результаты
- Реализован полноценный REST API сервис программы лояльности.
- Настроено хранение данных в PostgreSQL с генерацией кода через sqlc.
- Реализованы аутентификация, авторизация, gzip и логгирование.
- Написаны юнит-тесты и моки для бизнес-логики и хендлеров.
- Проект структурирован по принципам чистой архитектуры и готов к расширению.

## Как запустить

### 1. Клонировать репозиторий
```bash
git clone https://github.com/NailUsmanov/gophermart.git
cd gophermart
```

### 2. Создать файл .env
```env
DATABASE_DSN=postgres://user:password@localhost:5432/gophermart?sslmode=disable
RUN_ADDRESS=:8080
```

### 3. Поднять PostgreSQL (через Docker)
```bash
docker-compose up -d
```

### 4. Применить миграции
Через sqlc или вручную с SQL-скриптов

### 5. Запустить сервис
```bash
go run ./cmd/server
```

### 6. Запустить тесты
```bash
go test ./... -v
```

## Автор

Наиль Усманов
Backend-разработчик на Go
